package au.com.cfs.winged.core.services;

import au.com.cfs.winged.core.common.constants.ApplicationConstants;
import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import org.apache.sling.api.resource.Resource;
import org.apache.sling.api.resource.ResourceResolver;
import org.osgi.service.component.annotations.Component;

import java.io.InputStream;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.util.HashMap;
import java.util.Map;

@Component(service = DynamicFundService.class)
public class DynamicFundService {
    private String companyCode;
    private String api;
    private String fundLinkBaseUrl;

    public String getCompanyCode() {
        return companyCode;
    }

    public void setCompanyCode(String companyCode) {
        this.companyCode = companyCode;
    }

    public String getApi() {
        return api;
    }

    public void setApi(String api) {
        this.api = api;
    }

    public String getFundLinkBaseUrl() {
        return fundLinkBaseUrl;
    }

    public void setFundLinkBaseUrl(String fundLinkBaseUrl) {
        this.fundLinkBaseUrl = fundLinkBaseUrl;
    }

    public void fetchAndSetValues(ResourceResolver resourceResolver) {
        Resource resource = resourceResolver.getResource(ApplicationConstants.END_POINT_LIST_PATH);
        if (resource != null) {
            try (InputStream inputStream = resource.adaptTo(InputStream.class);
                 InputStreamReader reader = new InputStreamReader(inputStream, StandardCharsets.UTF_8)) {

                JsonArray jsonArray = JsonParser.parseReader(reader).getAsJsonArray();
                Map<String, String> values = new HashMap<>();
                for (int i = 0; i < jsonArray.size(); i++) {
                    JsonObject jsonObject = jsonArray.get(i).getAsJsonObject();
                    String text = jsonObject.get("text").getAsString();
                    String value = jsonObject.get("value").getAsString();
                    values.put(text, value);
                }
                setCompanyCode(values.get("companyCode"));
                setApi(values.get("api"));
                setFundLinkBaseUrl(values.get("fundLinkBaseUrl"));
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}

...........................................
                    package au.com.cfs.winged.core.models;

import au.com.cfs.winged.core.models.common.ButtonsModel;
import au.com.cfs.winged.core.services.DynamicFundService;
import org.apache.sling.api.SlingHttpServletRequest;
import org.apache.sling.api.resource.ResourceResolver;
import org.apache.sling.models.annotations.DefaultInjectionStrategy;
import org.apache.sling.models.annotations.Model;
import org.apache.sling.models.annotations.injectorspecific.OSGiService;
import org.apache.sling.models.annotations.injectorspecific.ValueMapValue;

import javax.annotation.PostConstruct;
import javax.inject.Inject;

@Model(adaptables = SlingHttpServletRequest.class, adapters = DynamicFundCardModel.class, defaultInjectionStrategy = DefaultInjectionStrategy.OPTIONAL)
public class DynamicFundCardModel extends ButtonsModel {

    @Inject
    private ResourceResolver resourceResolver;

    @ValueMapValue
    private String layout;

    @ValueMapValue
    private String cardSize;

    @ValueMapValue
    private String apir;

    @ValueMapValue
    private String inception;

    @ValueMapValue
    private String content;

    @ValueMapValue
    private String imageUrl;

    @ValueMapValue
    private String horizontalLine;

    @ValueMapValue
    private String verticalLine;

    @ValueMapValue
    private String mainGroup;

    @ValueMapValue
    private String product;

    @ValueMapValue
    private String year;

    private String companyCode;

    private String api;

    private String fundLinkBaseUrl;

    @OSGiService
    private DynamicFundService dynamicFundService;

    @PostConstruct
    protected void init() {
        // Fetch and set values in DynamicFundService
        dynamicFundService.fetchAndSetValues(resourceResolver);

        // Initialize model fields with values from DynamicFundService
        companyCode = dynamicFundService.getCompanyCode();
        api = dynamicFundService.getApi();
        fundLinkBaseUrl = dynamicFundService.getFundLinkBaseUrl();
    }

    public String getLayout() {
        return layout;
    }

    public String getCardSize() {
        return cardSize;
    }

    public String getApir() {
        return apir;
    }

    public String getContent() {
        return content;
    }

    public String getImageUrl() {
        return imageUrl;
    }

    public String getHorizontalLine() {
        return horizontalLine;
    }

    public String getVerticalLine() {
        return verticalLine;
    }

    public String getMainGroup() {
        return mainGroup;
    }

    public String getProduct() {
        return product;
    }

    public String getYear() {
        return year;
    }

    public String getCompanyCode() {
        return companyCode;
    }

    public String getApi() {
        return api;
    }

    public String getInception() {
        return inception;
    }

    public String getFundLinkBaseUrl() {
        return fundLinkBaseUrl;
    }
}

                    
